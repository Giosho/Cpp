#include <iostream>
#include <string>
#include <fstream>

using namespace std;

bool Login(string& username, string& password)
{
    string fileUser, filePass;
    ifstream input("info.txt");

    if (!input) {
        cout << "No registration found. Please register first." << endl;
        return false;
    }

    getline(input, fileUser);
    getline(input, filePass);
    input.close();

    while (true) {
        cout << "Enter Name:" << endl;
        cin >> username;
        cout << "Enter Password:" << endl;
        cin >> password;

        if (username == fileUser && password == filePass) {
            cout << "Login successful!" << endl;
            return true;
        }
        else {
            cout << "Incorrect username or password!" << endl;
        }
    }
}

void Bank(string name, string pass) {


    // Твърдо кодирани потребителско име и парола — лесно се "хакват".
    //  Поне направи променливите const или използвай файл/масив с валидни акаунти.
    bool brick = false;

    while (brick == false) {
        cout << "Welcome!" << endl;

        int mon = 2000;
        string option;
        cout << "do you wanna add/take/view your money or to leave your account /exit/?" << endl;
        cin >> option;

        if (option == "add") {
            int add;
            cout << "How much do you want to add?" << endl;
            cin >> add;

            if (add < 0) {
                cout << "Can't add negative amount!" << endl;
            }
            else {
                mon += add;
                cout << "Your balance is now: " << mon << endl;
            }
        }
        else if (option == "take") {
            int take;
            cout << "How much do you want to take?" << endl;
            cin >> take;

            if (take > mon) {
                cout << "Not enough money!" << endl;
            }
            else if (take < 0) {
                cout << "Invalid amount!" << endl;
            }
            else {
                mon -= take;
                cout << "Your balance is now: " << mon << endl;
            }
        }
        else if (option == "view") {
            cout << "Your balance is: " << mon << endl;
        }
        else if (option == "exit") {
            brick = true;
        }
        else {
            cout << "Invalid option!" << endl;
        }

        // Потребителят може да избере само едно действие, след това програмата приключва.
        // Направи цикъл, който позволява многократни действия, докато напише "exit"
    }
}

void Register()
{
    ofstream output;

    output.open("info.txt");

    string reg;
    string pass;
    string conpass;
    cout << "Register!" << endl;

    cout << "Name:" << endl;
    cin >> reg;
    cout << "Type Password" << endl;
    cin >> pass;
    cout << "Confirm Password" << endl;
    cin >> conpass;

    if (pass == conpass)
    {
        if (output.fail())
        {
            cout << "Error to craete file." << endl;
            return;
        }

        output << reg << endl;
        output << pass << endl;
        output.close();
        cout << "Log In saved." << endl;
    }
    else
    {
        cout << "Password is not the same!" << endl;
    }

    cin.get();
    return;
}

int main() {
    string user, pass;
    string option;

    cout << "Log in/Register/Exit" << endl;
    cin >> option;

    if (option == "Register" || option == "register") {
        Register();
    }
    else if (option == "Login" || option == "login") {
        if (Login(user, pass)) {
            Bank(user, pass);
        }
    }
    else if (option == "Exit" || option == "exit") {
        return 0;
    }
    else {
        cout << "Invalid option!" << endl;
    }

    return 0;
}
